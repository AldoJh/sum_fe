<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Edit Data Tiang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="bg-red-800 text-white w-64 flex flex-col items-center py-8 relative">
            <div class="profile-pic bg-gray-300 rounded-full w-24 h-24 mb-4"></div>
            <h2 class="text-xl mb-8">SUPER ADMIN</h2>
            <nav class="flex flex-col space-y-4">
                <a class="text-lg" href="admin.html">DASHBOARD</a>
                <a class="text-lg" href="report.html">REPORT</a>       
            </nav>
            <!-- Teks "DASHBOARD ADMIN" yang diputar ke kiri -->
      <div class="absolute top-1/2 left-[90%] transform -translate-x-1/2 -translate-y-1/2 -rotate-90 text-6xl font-extrabold tracking-widest leading-none whitespace-nowrap">
        DATA EDIT TIANG
      </div>

      <!-- Tombol Logout -->
      <div class="mt-auto mb-8">
        <button id="logout-btn" class="bg-white text-green-800 px-4 py-2 rounded-full hover:bg-red-600 hover:text-white transition duration-300">
          LOG OUT
        </button>
      </div>
    </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-2xl font-semibold">Form Edit Data Tiang</h1>
                <button class="btn-back" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i> Kembali
                </button>
            
                <script>
                    function goBack() {
                        window.location.href = '../admin.html';
                    }
                </script>
            </div>
            <form class="grid grid-cols-2 gap-8">
                <div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Kode Tiang :</label>
                        <input type="text" name="kode_tiang" class="w-full border border-gray-300 p-2">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Gambar :</label>
                        <div class="border border-gray-300 p-2 flex justify-center items-center">
                            <input type="file" id="fileInput" class="hidden">
                            <button type="button" class="bg-gray-300 text-gray-700 py-2 px-4" onclick="document.getElementById('fileInput').click()">Choose File</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Provinsi :</label>
                        <input type="text" name="provinsi" class="w-full border border-gray-300 p-2">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Kabupaten :</label>
                        <input type="text" name="kabupaten" class="w-full border border-gray-300 p-2">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Kota:</label>
                        <input type="text" name="kota" class="w-full border border-gray-300 p-2">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Nama Jalan :</label>
                        <input type="text" name="nama_jalan" class="w-full border border-gray-300 p-2">
                    </div>
                    <div class="mb-4 flex space-x-4">
                        <!-- Kotak Ukuran -->
                        <div class="w-1/2">
                            <label class="block text-gray-700">Ukuran :</label>
                            <input type="text" name="ukuran" class="w-full border border-gray-300 p-2 text-sm">
                        </div>
                    
                        <!-- Kotak Sisi -->
                        <div class="w-1/2">
                            <label class="block text-gray-700">Sisi :</label>
                            <input type="text" name="sisi" class="w-full border border-gray-300 p-2 text-sm">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Jenis :</label>
                        <div class="flex items-center">
                            <input type="radio" name="jenis" class="mr-2" value="billboard"> Billboard
                            <input type="radio" name="jenis" class="ml-4 mr-2" value="baliho"> Baliho
                            <input type="radio" name="jenis" class="ml-4 mr-2" value="videotron"> Videotron
                        </div>
                    </div>
                </div>
                <div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Jenis Lampu :</label>
                        <div class="flex items-center">
                            <input type="radio" name="jenis_lampu" class="mr-2" value="front light"> FrontLight
                            <input type="radio" name="jenis_lampu" class="ml-4 mr-2" value="back light"> BackLight
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Titik Kordinat :</label>
                        <input type="text" name="lat" class="w-full border border-gray-300 p-2">
                        <input type="text" name="long" class="w-full border border-gray-300 p-2">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Jumlah Kendaraan :</label>
                        <div class="flex items-center">
                            <input type="text" name="jumlah_kendaraan" class="w-1/2 border border-gray-300 p-2">
                            <span class="ml-2">/ Hari</span>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Nama Pemilik Tiang :</label>
                        <input type="text" name="nama_pemilik" class="w-full border border-gray-300 p-2">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-500">Harga :</label>
                        <div class="flex items-center">
                            <span class="mr-2">Rp</span>
                            <input type="text" name="harga" class="w-full border border-gray-300 p-2">
                        </div>
                    </div>
                    <div class="flex justify-center mt-4">
                        <button type="button" class="bg-blue-500 text-white py-2 px-4 rounded-full mr-2" onclick="saveData()">Simpan</button>
                        <button type="button" class="bg-red-500 text-white py-2 px-4 rounded-full" onclick="openCancelPopup()">Batal</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

     <!-- Custom Modal Popup -->
     <div id="cancelPopup" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <p class="text-lg font-semibold mb-4">Anda yakin ingin membatalkan perubahan?</p>
            <div class="flex justify-end">
                <button class="bg-gray-300 text-gray-800 py-2 px-4 rounded-full mr-2" onclick="closeCancelPopup()">Tidak</button>
                <button class="bg-red-500 text-white py-2 px-4 rounded-full" onclick="confirmCancel()">Ya</button>
            </div>
        </div>
    </div>

    <script>
        // Fungsi Logout
        document.getElementById("logout-btn").addEventListener("click", function () {
            alert("Anda telah logout!");
            window.location.href = "/sum_fe/Login/login.html"; // Redirect ke halaman login
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get("code");

            if (!id) {
                console.error("ID tidak ditemukan di URL.");
                return;
            }

            try {
                const response = await axios.get(`http://localhost:3000/data/id/${id}`);
                const data = response.data;

                if (!data) {
                    console.error("Data tidak ditemukan.");
                    return;
                }

                // Mengisi form dengan data yang didapat
                setInputValue("kode_tiang", data.kode_tiang);
                setInputValue("provinsi", data.provinsi);
                setInputValue("kabupaten", data.kabupaten);
                setInputValue("kota", data.kota);
                setInputValue("nama_jalan", data.nama_jalan);
                setInputValue("ukuran", data.ukuran);
                setInputValue("sisi", data.sisi);
                setRadioValue("jenis", data.jenis);
                setRadioValue("jenis_lampu", data.jenis_lampu);
                setInputValue("lat", data.lat);
                setInputValue("long", data.long);
                setInputValue("jumlah_kendaraan", data.jumlah_kendaraan);
                setInputValue("nama_pemilik", data.nama_pemilik);
                setInputValue("harga", data.harga);

            } catch (error) {
                console.error("Terjadi kesalahan saat mengambil data:", error);
                alert("Gagal mengambil data. Periksa koneksi atau API.");
            }
        });

        // Fungsi untuk mengisi input text
        function setInputValue(name, value) {
            const input = document.querySelector(`input[name="${name}"]`);
            if (input) {
                input.value = value || "";
            } else {
                console.warn(`Elemen dengan nama '${name}' tidak ditemukan.`);
            }
        }

        // Fungsi untuk mengisi radio button
        function setRadioValue(name, value) {
            const radios = document.querySelectorAll(`input[name="${name}"]`);
            if (radios.length > 0) {
                radios.forEach((radio) => {
                    if (radio.value === value) {
                        radio.checked = true;
                    }
                });
            } else {
                console.warn(`Radio button dengan nama '${name}' tidak ditemukan.`);
            }
        }

        // Fungsi untuk menyimpan data
        async function saveData() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get("code");

            if (!id) {
                alert("ID tidak ditemukan.");
                return;
            }

            const formData = {
                kode_tiang: getInputValue("kode_tiang"),
                provinsi: getInputValue("provinsi"),
                kabupaten: getInputValue("kabupaten"),
                kota: getInputValue("kota"),
                nama_jalan: getInputValue("nama_jalan"),
                ukuran: getInputValue("ukuran"),
                sisi: getInputValue("sisi"),
                jenis: getRadioValue("jenis"),
                jenis_lampu: getRadioValue("jenis_lampu"),
                lat: getInputValue("lat"),
                long: getInputValue("long"),
                jumlah_kendaraan: getInputValue("jumlah_kendaraan"),
                nama_pemilik: getInputValue("nama_pemilik"),
                harga: getInputValue("harga"),
            };

            try {
                const response = await axios.put(`http://localhost:3000/data/id/${id}`, formData);
                alert("Data berhasil diperbarui!");
                window.location.href = "../admin.html";
            } catch (error) {
                console.error("Gagal menyimpan data:", error);
                alert("Terjadi kesalahan saat menyimpan data.");
            }
        }

        // Fungsi untuk mendapatkan nilai dari input text
        function getInputValue(name) {
            const input = document.querySelector(`input[name="${name}"]`);
            return input ? input.value : "";
        }

        // Fungsi untuk mendapatkan nilai dari radio button
        function getRadioValue(name) {
            const radio = document.querySelector(`input[name="${name}"]:checked`);
            return radio ? radio.value : "";
        }

        // Fungsi membuka popup batal
        function openCancelPopup() {
            document.getElementById("cancelPopup").classList.remove("hidden");
        }

        // Fungsi menutup popup batal
        function closeCancelPopup() {
            document.getElementById("cancelPopup").classList.add("hidden");
        }

        // Fungsi konfirmasi pembatalan
        function confirmCancel() {
            alert("Perubahan dibatalkan!");
            closeCancelPopup();
        }

        // Fungsi Logout
        document.getElementById("logout-btn").addEventListener("click", function () {
            alert("Anda telah logout!");
            window.location.href = "/sum_fe/Login/login.html"; // Redirect ke halaman login
        });

    </script>
    
        
    </body>
    </html>
    