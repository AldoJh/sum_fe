<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Edit Data Tiang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="bg-red-800 text-white w-64 flex flex-col items-center py-8 relative">
            <div class="profile-pic bg-gray-300 rounded-full w-24 h-24 mb-4"></div>
            <h2 class="text-xl mb-8">SUPER ADMIN</h2>
            <nav class="flex flex-col space-y-4">
                <a class="text-lg" href="../admin.html">DASHBOARD</a>
                <a class="text-lg" href="../report.html">REPORT</a>       
            </nav>
        <!-- Teks "DASHBOARD ADMIN" yang diputar ke kiri -->
      <div class="absolute top-1/2 left-[90%] transform -translate-x-1/2 -translate-y-1/2 -rotate-90 text-6xl font-extrabold tracking-widest leading-none whitespace-nowrap">
        DATA INPUT TIANG
      </div>

      <!-- Tombol Logout -->
      <div class="mt-auto mb-8">
        <button id="logout-btn" class="bg-white text-green-800 px-4 py-2 rounded-full hover:bg-red-600 hover:text-white transition duration-300">
          LOG OUT
        </button>
      </div>
    </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-2xl font-semibold">Data Input Tiang</h1>
                <button class="btn-back" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i> Kembali
                </button>
            
                <script>
                    function goBack() {
                        window.location.href = '../admin.html';
                    }
                </script>
            </div>
            <form id="dataForm" class="grid grid-cols-2 gap-8">
                <div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Kode Tiang :</label>
                        <input type="text" name="kode_tiang" id="kode_tiang" class="w-full border border-gray-300 p-2" >
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Gambar :</label>
                        <div class="border border-gray-300 p-2 flex justify-center items-center">
                            <input type="file" id="fileInput" class="hidden" onchange="previewImage(event)">
                            <button type="button" class="bg-gray-300 text-gray-700 py-2 px-4" onclick="document.getElementById('fileInput').click()">Choose File</button>
                        </div>
                        <div id="imagePreview" class="mt-4"></div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Provinsi :</label>
                        <input type="text" name="provinsi" id="provinsi" class="w-full border border-gray-300 p-2" >
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Kabupaten :</label>
                        <input type="text" name="kabupaten" id="kabupaten" class="w-full border border-gray-300 p-2" >
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Kota:</label>
                        <input type="text" name="kota" id="kota" class="w-full border border-gray-300 p-2" >
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Nama Jalan :</label>
                        <input type="text" name="nama_jalan" id="nama_jalan" class="w-full border border-gray-300 p-2" >
                    </div>
                    <div class="mb-4 flex space-x-4">
                        <div class="w-1/2">
                            <label class="block text-gray-700">Ukuran :</label>
                            <input type="text" name="ukuran" id="ukuran" class="w-full border border-gray-300 p-2 text-sm" >
                        </div>
                    
                        <div class="w-1/2">
                            <label class="block text-gray-700">Sisi :</label>
                            <input type="text" name="sisi" id="sisi" class="w-full border border-gray-300 p-2 text-sm" >
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Jenis :</label>
                        <div class="flex items-center">
                            <input type="radio" name="jenis" id="jenis" value="billboard" class="mr-2" checked> Billboard
                            <input type="radio" name="jenis" id="jenis" value="baliho" class="ml-4 mr-2"> Baliho
                            <input type="radio" name="jenis" id="jenis" value="videotron" class="ml-4 mr-2"> Videotron
                        </div>
                    </div>
                </div>
                <div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Jenis Lampu :</label>
                        <div class="flex items-center">
                            <input type="radio" name="jenis_lampu" id="jenis_lampu" value="front light" class="mr-2" checked> FrontLight
                            <input type="radio" name="jenis_lampu" id="jenis_lampu" value="back light" class="ml-4 mr-2"> BackLight
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Titik Kordinat :</label>
                        <input type="text" name="titik_kordinat" id="titik_koordinat" class="w-full border border-gray-300 p-2" value="1.036573253609591, 104.24891992465353">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Jumlah Kendaraan :</label>
                        <div class="flex items-center">
                            <input type="text" name="jumlah_kendaraan" id="jumlah_kendaraan" class="w-1/2 border border-gray-300 p-2" >
                            <span class="ml-2">/ Hari</span>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700">Nama Pemilik Tiang :</label>
                        <input type="text" name="nama_pemilik" id="nama_pemilik" class="w-full border border-gray-300 p-2" >
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-500">Harga :</label>
                        <div class="flex items-center">
                            <span class="mr-2">Rp</span>
                            <input type="text" name="harga" id="harga" class="w-full border border-gray-300 p-2" >
                        </div>
                    </div>
                    <div class="flex justify-center mt-4">
                        <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded-full mr-2">Simpan</button>
                        <button type="button" class="bg-red-500 text-white py-2 px-4 rounded-full" onclick="openCancelPopup()">Batal</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Modal Popup -->
    <div id="cancelPopup" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <p class="text-lg font-semibold mb-4">Anda yakin ingin membatalkan perubahan?</p>
            <div class="flex justify-end">
                <button class="bg-gray-300 text-gray-800 py-2 px-4 rounded-full mr-2" onclick="closeCancelPopup()">Tidak</button>
                <button class="bg-red-500 text-white py-2 px-4 rounded-full" onclick="confirmCancel()">Ya</button>
            </div>
        </div>
    </div>
    
    <script>
        function openCancelPopup() {
            document.getElementById('cancelPopup').classList.remove('hidden');
        }
        function closeCancelPopup() {
            document.getElementById('cancelPopup').classList.add('hidden');
        }
        function confirmCancel() {
            alert('Perubahan dibatalkan!');
            closeCancelPopup();
            
        }
        

 // Fungsi Logout
 document.getElementById("logout-btn").addEventListener("click", function () {
          alert("Anda telah logout!");
          window.location.href = "/sum_fe/Login/login.html"; // Redirect ke halaman login
        });

         // Preview the selected image
         function previewImage(event) {
            const file = event.target.files[0]; // Get the file selected by the user
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imagePreview = document.getElementById('imagePreview');
                    imagePreview.innerHTML = `<img src="${e.target.result}" alt="Image Preview" class="w-32 h-32 object-cover">`;
                };
                reader.readAsDataURL(file); // Convert file to base64 and display it
            }
        }

        

        // Handle form submission
        document.getElementById("dataForm").addEventListener("submit", async function(event) {
            event.preventDefault();
          
            
            const formData = new FormData();
        
            // Ambil data dari form
            formData.append("kode_tiang", document.querySelector('input[name="kode_tiang"]').value);
            formData.append("jenis_lampu", document.querySelector('input[name="jenis_lampu"]:checked').value);
            formData.append("lat", document.querySelector('input[name="titik_kordinat"]').value.split(',')[0].trim());
            formData.append("long", document.querySelector('input[name="titik_kordinat"]').value.split(',')[1].trim());
            formData.append("jumlah_kendaraan", document.querySelector('input[name="jumlah_kendaraan"]').value);
            formData.append("provinsi", document.querySelector('input[name="provinsi"]').value);
            formData.append("kabupaten", document.querySelector('input[name="kabupaten"]').value);
            formData.append("kota", document.querySelector('input[name="kota"]').value);
            formData.append("nama_jalan", document.querySelector('input[name="nama_jalan"]').value);
            formData.append("ukuran", document.querySelector('input[name="ukuran"]').value);
            formData.append("sisi", document.querySelector('input[name="sisi"]').value);
            formData.append("jenis", document.querySelector('input[name="jenis"]:checked').value);
            formData.append("nama_pemilik", document.querySelector('input[name="nama_pemilik"]').value);
        
            const fileInput = document.getElementById('fileInput');
            const imageFile = fileInput.files[0];
            if (imageFile) {
                formData.append('gambar', imageFile); // Menambahkan file gambar ke FormData
            }
        
            try {
                const response = await fetch("http://localhost:3000/data", {
                    method: "POST",
                    body: formData, // Mengirim data dengan FormData (termasuk file)
                });
        
                const result = await response.json();
                if (response.ok) {
                    alert("Data berhasil disimpan");
                    window.location.href = "sum_fe/Login/Admin/admin.html"; // Redirect setelah berhasil
                } else {
                    alert("Gagal menyimpan data: " + result.message);
                }
            } catch (error) {
                alert("Terjadi kesalahan: " + error.message);
            }
        });
            
            // Popup Modal untuk Status Sewa
            const statusDropdown = document.getElementById("status-sewa");
            const popupModal = document.getElementById("popup-modal");
            const popupTitle = document.getElementById("popup-title");
            const popupMessage = document.getElementById("popup-message");
            const closePopup = document.getElementById("close-popup");
        
            statusDropdown.addEventListener("change", function () {
              if (this.value === "available" || this.value === "rented") {
                popupTitle.innerText = "Status Sewa Dipilih";
                popupMessage.innerText = `Anda memilih status: ${this.options[this.selectedIndex].text}`;
                popupModal.classList.remove("hidden");
              }
            });
        
            closePopup.addEventListener("click", function () {
              popupModal.classList.add("hidden");
            });
          </script>
    
        <script>
            function saveData() {
                alert('Data berhasil disimpan!');
                window.location.href = "sum_fe/Login/Admin/admin.html";
            }
            function openCancelPopup() {
                document.getElementById('cancelPopup').classList.remove('hidden');
            }
            function closeCancelPopup() {
                document.getElementById('cancelPopup').classList.add('hidden');
            }
            function confirmCancel() {
                alert('Perubahan dibatalkan!');
                closeCancelPopup();
            }
        </script>
    
        
    </body>
    </html>
    

</body>
</html>
